{header}
<link rel="stylesheet" type="text/css" href="{url_main}_frameworks/administration/modern/app-assets/vendors/css/vendors.min.css{cache_version_param}">
<!-- file upload -->
<link rel="stylesheet" type="text/css" href="{url_main}_frameworks/administration/modern/app-assets/vendors/css/file-uploaders/dropzone.min.css{cache_version_param}">
<link rel="stylesheet" type="text/css" href="{url_main}_frameworks/administration/modern/app-assets/css/plugins/file-uploaders/dropzone.css{cache_version_param}">

<!-- location -->
<script type="text/javascript" src="{url_main}_server/jquery/jquery.location.js{cache_version_param}"></script>

<!-- phone number -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.3/build/css/intlTelInput.css">
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.3/build/js/intlTelInput.min.js"></script>

<script>
    var joinLangParts = {
        choose_a_city : 'Select {l_city}',
        choose_a_state : 'Select {l_state}'
    };
    nameLengthMin='{username_length_min}'*1;
    nameLengthMax='{username_length}'*1;
</script>
<style type="text/css">
    .add_group_user_link {color: blue;font-weight: bold;display: inline-block;margin-bottom: 20px}

    /* Drop zone */
    .dropzone .dz-preview.dz-error .dz-info,
    .dropzone .dz-preview.dz-error .dz-details,
    .dropzone .dz-preview.dz-error .dz-image img,
    .dropzone .dz-preview.dz-error .dz-progress,
    .dropzone .dz-preview.dz-error .dz-converting,
    .dropzone .dz-preview.dz-error .dz-converting-complete{
        opacity: 0!important;
        transition: opacity .25s linear, visibility 0s .25s;
        visibility: hidden;
    }

    .dropzone .dz-preview.dz-error .dz-error-message {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        opacity: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
        text-align: center;
    }

    /* Single icon */
    .dpz-upload-single-icon.dropzone{
        min-height: auto;
        height: 145px;
        width: 205px;
        position: relative;
        border: 1px dashed #7b7a7a;
        background: #fbfbfb;
        padding: 0;
        overflow: hidden;
        border-radius: 0.25rem;
    }

    .dpz-upload-single-icon.dropzone .dz-preview.dz-error .dz-error-message {
        font-size: 11px;
        top: 85px;
        width: calc(100% - 10px);
        margin-left: 5px;
    }

    .dropzone .dz-preview .dz-details .dz-filename{
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .dropzone .dz-preview .dz-details .dz-filename span{
        padding: 0.4em;
        border-radius: 4px;
        display: inline-block;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .dpz-upload-single-icon.dropzone .dz-message{
        height: 145px;
        margin: 0;
        top: 0;
        font-size: 12px;
        color: #9b9a9a;
        transition: color .3s;
    }

    .dpz-upload-single-icon.dropzone .dz-message:before{
        font: normal normal normal 16px/1 LineAwesome;
        content: "\f194";
        color: #9b9a9a;
        font-size: 34px;
        position: absolute;
        top: 50px;
        width: 34px;
        height: 34px;
        left: 50%;
        margin-left: -17px;
        transition: color .3s;
    }

    .dpz-upload-single-icon.dropzone .dz-message:hover,
    .dpz-upload-single-icon.dropzone .dz-message:hover:before{
        color: #7a7979;
    }

    .dpz-upload-single-icon.dropzone .dz-default.dz-message span{
        /*display: none;*/
        position: absolute;
        top: 110px;
        width: 100%;
        margin: 0;
        left: 0;
    }

    .dpz-upload-single-icon.dropzone .dz-preview {
        min-height: 195px;
        height: 195px;
        overflow: hidden;
        margin: 4px;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-image {
        border-radius: 0px;
        width: 195px;
        height: 195px;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-image img{
        width: 195px;
        height: 195px;
        object-fit: contain;
    }

    .dpz-upload-single-icon.dropzone  .dz-preview.dz-image-preview {
        background: #8c94a2;
    }

    .dropzone .dz-preview .dz-details{
        top: 60px;
    }

    @media (max-width: 414.98px){
        .dpz-upload-single-icon.dropzone{
            margin: 0 auto;
        }
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-remove{
        line-height: 1;
        position: absolute;
        top: 2px;
        right: 2px;
        z-index: 21;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-remove:before {
        content: "\e9e4";
        font-family: 'feather';
        color: #ffffff;
        opacity: .8;
        font-size: 16px;
    }

    .dpz-upload-single-icon.dropzone .dz-preview.dz-error .dz-remove:before {
        color: #7b7a7a;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-details .dz-size {
        display: none;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-details .dz-filename {
        font-size: 11px;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-progress {
        height: 8px;
        margin-top: 4px;
        width: 60px;
        margin-left: -30px;
        border-radius: 4px;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-success-mark,
    .dpz-upload-single-icon.dropzone .dz-preview .dz-error-mark {
        margin-left: -12px;
        margin-top: -12px;
    }

    .dpz-upload-single-icon.dropzone .dz-preview .dz-success-mark svg,
    .dpz-upload-single-icon.dropzone .dz-preview .dz-error-mark svg {
        width: 24px;
        height: 24px;
    }

    /*form css*/
    .bl_form_registration{ display: flex; }
    .bl_form_registration .part{ width: 317px; float: left; padding: 0 0 20px 40px; position: relative; }

    .bl_form_registration .part .or{ position: absolute; top: 130px; right: -25px; font-size: 18px; line-height: 46px; color: #fff; border: 1px solid rgba(225, 225, 225, 0.40); width: 48px; height: 48px; border-radius: 50%; }

    .bl_form_registration .part .bl{ text-align: left; margin: 0 0 18px; position: relative; display: block; padding: 0; }
    .bl_form_registration .part .bl label{ display: block; margin: 0 0 10px; font-weight:600 }
    .bl_form_registration .part .bl input.inp{ height: 34px; margin: 0; padding: 0 21px 0 11px; }
    .bl_form_registration .part .bl input.inp.city{ width: 317px; }
    .bl_form_registration .part .bl input.inp.email{ width: 317px; }
    .bl_form_registration .part .bl input.inp.name{ width: 317px; }
    .bl_form_registration .part .bl input.inp.phone{ width: 317px; }
    .bl_form_registration .part .bl input.inp.username{ width: 317px; }
    .bl_form_registration .part .bl .bl_city{ float: right; position: relative; }

    .bl_form_registration button.btn img{ position: absolute; top: 16px; left: 18px; }
    .bl_form_registration .part.br{ padding: 81px 40px 0 0; height: 290px; display: table-cell; vertical-align: middle; }
    .bl_form_registration .part.br .btn{ margin: 8px 0 12px; }
    .bl_form_registration .part.center{ margin: 0 auto; float: none; padding: 0; }
    .bl_form_registration .jq-selectbox__select{ width: 317px; box-sizing: border-box; padding: 0 11px; margin: 0 9px 0 0; }
    .bl_form_registration .jq-selectbox__dropdown{ width: 317px; margin: -4px 0; /*padding: 8px 0 0;*/ }
    .bl_form_registration .inp_birth{ float: left; position: relative; opacity:0;}
    .bl_form_registration .inp_birth.to_show{opacity:1; transition:opacity .35s linear;}
    .bl_form_registration .part .bl .inp_birth .icon_check{ z-index: 12; right: 17px; }
    .bl_form_registration .inp_birth.dd .jq-selectbox.birthday{ margin: 0 13px 0 0; }
    .bl_form_registration .inp_birth.mm .jq-selectbox.birthday{ margin: 0 13px 0 0; }
    .bl_form_registration .jq-selectbox.birthday .jq-selectbox__select{ width: 97px; margin: 0; }
    .bl_form_registration .jq-selectbox.birthday .jq-selectbox__dropdown{ width: 97px; top: 34px; overflow: hidden; }
    .bl_form_registration .jq-selectbox.birthday .jq-selectbox__dropdown ul{ max-height: 300px; }

    .bl_location{margin: 10px 0}

    form .btn{
        text-align: center;
        width: 200px;
        font-size: 18px;
        margin: 0 auto;
        display: block;
        font-weight: normal;
        height: 46px;
    }

    /*alert*/
    .alert {
        padding: 8px 20px;
        border-radius: 4px;
        position: relative;
        line-height: 24px;
        font-size: 12px;
    }

    .closebtn {
        margin-right: -10px;
        color: #e7495c;
        font-weight: bold;
        float: right;
        line-height: 20px;
        cursor: pointer;
        transition: 0.3s;
        border: 2px solid #e7495c;
        border-radius: 100%;
        background: #fff;
        height: 20px;
        width: 20px;
        text-align: center;
    }

    .closebtn:hover {
      color: #6c1c20;
    }
    .alert-warning {
        background-color: #f8d7da;
        color: #f00;
    }
    .alert-success {
        background-color: #5abd58;
        color: #FFFFFF;
    }
    .alert-warning, .alert-success {
      margin: 0 auto 20px
    }

    .candidate_profile {
        padding: 0 0 15px;
    }

    .candidate_profile .bl > label {
        padding: 10px 0;
        display: inline-block;
        font-weight: 600;
    }
    .custom_bl {
        margin: 10px auto;
        border: 1px solid #ddd;
        border-radius: 3px;
        background: #fff;
        padding: 10px;
        display: inline-flex;
    }
    .custom_bl .to_show {
        height: 30px;
        line-height: 30px;
        margin-left: 20px;
    }

    .manual_bl {
        display: inline-flex;
        gap: 10px;
        align-items: center;
        margin: 5px 0 10px;
    }

    .add_candidate_header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .add_candidate_header button {
        border: unset;
        font-size: 24px;
        color: #555;
        transition: 0.3s;
    }
    .add_candidate_header button:hover {
        color: #000;
    }

    .input_error { color: red; font-size: 12px; margin-top: 5px }
</style>
<div class="col_center">
    <div class="head icon_head_visitors add_candidate_header">
        <span>{page_title}</span>
        <button type="button" onclick="history.back()"><i class="fa fa-times"></i></button>
    </div>
    <a href="{main_url}group_users" class="add_group_user_link"><i class="fa fa-users"></i> {l_group_users}</a>

    <div class="alert alert-warning" id="warAlert" style="display: none;"></div>
    <div class="alert alert-success" id="sucAlert" style="display: none;"></div>
    
    <form id="frm_users_add" method="POST" action="#" name="add_user" autocomplete="off">  
        <div class="candidate_profile">                
            <div class="bl">
                <label>Upload Photo <small class="small_max_color">({l_photo_upload_max_size})</small></label>
                <div id="dpz-upload-single-icon" data-name="photo_file" class="dropzone dropzone-area dpz-upload-single-icon">
                    <input form="photo_insert" id="dpz-file-upload-file" class="image-data-url" type="hidden" name="photo_file">
                </div> 
            </div>

            <input type="hidden" value="1" name="have_cv" id="have_cv_yes">
            
            <div class="bl" id="candidate_auto">

                <label style="font-weight: bold; margin: 10px 0 0"><i class="fa fa-circle"></i> {l_auto_fillup_from_biodata}: <span style="font-weight: normal;color: blue;">(Allowed: .pdf, .docx)</span> <small class="small_max_color">({l_biodata_upload_max_size}) <span class="r">*</span></small> </label>
                <div class="manual_bl">
                    <input type="file" id="candidate_cv" name="candidate_cv" accept=".pdf, .docx">
                    <button type="submit" id="UploadSubmit" class="btn turquoise small" style="width: 120px">Upload</button>
                </div>


                <label style="display: inline-block;width: 100%;color: gray">-------------- or --------------</label>
            </div>
            <div class="bl manual_bl">
                <label style="font-weight: bold;"><i class="fa fa-circle"></i> {l_manually_fill_up_from_candidate}: </label>
                <button type="button" class="btn turquoise small" id="manualClickbutton" style="width: 120px" onclick="show_candidate_manual()">Fill Up</button>
            </div> 
        </div>

        <div class="bl_form_registration" id="candidate_manual" style="display: none;"> 
            <input type="hidden" name="cmd" value="insert">
            <input type="hidden" name="cmd_ajax" value="1">

            <div class="part" style="padding-left: 0;">  

                <div class="bl">
                    <label>{l_candiate_name} <span class="r">*</span></label>
                    <div class="to_show">
                        <input id="username" class="inp name placeholder" name="username" maxlength="100" type="text" placeholder="{l_type_name}" />
                    </div>
                    <div id="username_error" class="input_error"></div>
                </div>

                <div class="bl">
                    <label>{l_gender} <span class="r">*</span></label>
                    <div class="bl_select">
                        <select id="bl_join_done_orientation" name="orientation" class="i_am">
                            <option value="" disabled selected>{l_select}</option>
                            {orientation_options}
                        </select>
                    </div>
                </div>  

                <div class="bl">
                    <label>{l_phone_number} <span class="r">*</span></label>
                    <div class="to_show">
                        <input type="number" id="join_phone_number" class="inp phone" maxlength="11" placeholder="{l_placeholder_phone}">
                        <input type="hidden" name="phone" id="full_phone_number"/>
                        <div id="phone_error" style="color: red; padding-top: 5px;" class="error"></div>
                    </div>
                </div>

                <div class="bl">
                    <label>{l_email}</label>
                    <div class="to_show">
                        <input id="email" name="email" class="inp email placeholder" type="text" placeholder="{l_placeholder_email}" />
                    </div>
                </div>
            </div>

            <div class="part">

                <div class="bl">
                    <label>{l_date_birth} <span class="r">*</span></label>
                    <div class="dateOfBirth">
                        <div class="inp_birth dd">
                            <select name="day" id="day" class="birthday">
                                <option value="" disabled selected>{l_select}</option>
                                {day_options}
                            </select>
                        </div>
                        <div class="inp_birth mm">
                            <select name="month" id="month" class="birthday">
                                <option value="" disabled selected>{l_select}</option>
                                {month_options}
                            </select>
                        </div>
                        <div class="inp_birth yy">
                            <select name="year" id="year" class="birthday">
                                <option value="" disabled selected>{l_select}</option>
                                {year_options}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="bl" style="margin-top: 15px;display: inline-block;">
                    <label>{l_country} <span class="r">*</span></label>
                    <div class="bl_location">
                        <select class="location" name="country"  id="country" data-type="geo_states">
                            <option value="0">- {l_country} -</option>
                            {country_options}
                        </select>
                    </div>
                </div>
                <div class="bl">
                    <label>{l_state} <span class="r">*</span></label>
                    <div class="bl_location">
                        <select class="location" name="state" id="state" data-type="geo_cities">
                            <option value="0">- {l_state} -</option>
                            {state_options}
                        </select>
                    </div>
                </div>
                <div class="bl">
                    <label>{l_city} <span class="r">*</span></label>
                    <div class="bl_location">
                        <select class="location" name="city" id="city">
                            <option value="0">- {l_city} -</option>
                            {city_options}
                        </select>
                    </div>
                </div>
                
            </div>
        </div>
        <div id="manualSubmit" style="display: none;">
            <button id="submit" type="submit" class="btn turquoise">{l_create_user}</button>
        </div>
    </form>

</div>

<script type="text/javascript">
    siteTitle = '{page_title}';

    const upload_max_filesize = {upload_max_filesize};

    const btnLoader = `
        <div class="css_loader pp_profile_edit_main_loader">
            <div class="spinner center">
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
                <div class="spinner-blade"></div>
            </div>
        </div>`;

    function nameValid(candidate_name) {
        if (candidate_name === "") 
            return false;   
        else if (candidate_name.length < 3) 
            return false;   
        else if (/[!?/@#$%^&*]/.test(candidate_name)) 
            return false; // Restrict only specific special characters
        else 
            return true;
    }
    $("#username").keyup(function() {
        var candidate_name = this.value;

        if(candidate_name == "") {
            $('#username_error').html(l('the_field_is_required')).removeClass('to_hide');
        } else if (candidate_name.length < 3) {
            $('#username_error').html(l('min_length_of_candidate_name')).removeClass('to_hide');
        } else if (/[!?/@#$%^&*]/.test(candidate_name)) {
            $('#username_error').html('{j_invalid_username}').removeClass('to_hide');
        } else {
            $('#username_error').empty().addClass('to_hide');
        }
    });

    function show_candidate_manual() {
        var isVisible = $("#candidate_manual").is(":visible");

        $("#candidate_manual, #manualSubmit, #candidate_auto").toggle();

        if (isVisible) {
            $("#manualClickbutton").text("Fill Up");
            $("#have_cv_yes").val(1)
        } else {
            $("#manualClickbutton").text("Back");
            $("#have_cv_yes").val(0)
        }
    }

    
    var _dzThumbnailWidth = 195,
        _dzThumbnailHeight = 195;
    $(function(){

        // set active color
        var groupUsersLink = document.querySelector('#narrow_menu_link_54');
        if(groupUsersLink)
            groupUsersLink.style.background = '#0a1f52';

        // phone number
        var phone_number = window.intlTelInput(document.querySelector("#join_phone_number"), {
            separateDialCode: true,
            preferredCountries:["bd","us","gb","sa","ae"],
            hiddenInput: "full",
            utilsScript: "https://cdn.jsdelivr.net/npm/intl-tel-input@17.0.3/build/js/utils.js"
        })
        document.getElementById('join_phone_number').onkeyup = function(){
            var full_number = phone_number.getNumber(intlTelInputUtils.numberFormat.E164);
            $("#full_phone_number").val(full_number);
        }

        // PHONE NUMBER VALIDATION START
        function validatePhoneNumber(phoneNumber) {

            var country_data = phone_number.getSelectedCountryData();
            var country_code = country_data.dialCode;

            // Remove all non-digit characters
            var cleaned = phoneNumber.replace(/\D/g, '');

            if(country_code == "880") {

                // Check if the phone number starts with '01' and has a length of 11
                if (cleaned.startsWith('01') && cleaned.length === 11) {
                    return true;
                }

                // Check if the phone number starts with '1' and has a length of 10
                if (cleaned.startsWith('1') && cleaned.length === 10) {
                    return true;
                }

                // Check if the phone number starts with '+880' and has a length of 14
                if (phoneNumber.startsWith('+880') && phoneNumber.length === 14) {
                    return true;
                }
            } else {
                if (cleaned.length > 9 && cleaned.length < 13) {
                    return true;
                }
            }

            return false;
        }
        $("#join_phone_number").keyup(function() {

            if(validatePhoneNumber(this.value)) { // true
                $('#phone_error').empty();
            } else { // wrong
                $("#join_phone_number").focus();
                $('#phone_error').html("{l_phone_number_is_not_valid}");

                
            }
        });
        // PHONE NUMBER VALIDATION END

        /* Birth */
        $jq('.birthday').styler({singleSelectzIndex: '12',
            selectAutoWidth : false,
            selectAnimation: true,
            selectAppearsNativeToIOS: false,
            onFormStyled: function(){
                $jq('.inp_birth').addClass('to_show');
            }
        })
        /* Birth */

        $('.i_am').styler({
            singleSelectzIndex: '11',
            selectAutoWidth: false,
            selectAnimation: true,
            selectAppearsNativeToIOS: false,
            onFormStyled: function(){
                $jq('.bl_select').addClass('to_show');
            }
        })
        $jq('.location').styler({singleSelectzIndex: '12',
            selectAutoWidth : false,
            selectAnimation: true,
            selectAppearsNativeToIOS: false,
            onFormStyled: function(){
                $jq('.bl_location').addClass('to_show');
            }
        })


        // location
        // $('#country').location({first_option_state: '- {j_state_province} -', first_option_city: '- {j_city} -', location: 'add_user'});
        // $('#state').location({method: 'cities', first_option_city: '- {j_city} -', location: 'add_user'});


        $('#country, #state').change(function() {
            var type=$(this).data('type');
            $.ajax({
                type: 'POST',
                url: '{url_main}ajax.php',
                data: {
                    cmd:type,
                    select_id:this.value,
                    filter:'1',
                    list: 0
                },
                beforeSend: function(){
                    $jq('#css_loader_location').removeClass('hidden');
                    $jq('.location').prop('disabled', true).trigger('refresh');
                },
                success: function(res){
                    var data=checkDataAjax(res);
                    if (data) {
                        var option='<option value="0">'+joinLangParts.choose_a_city+'</option>';
                        switch (type) {
                            case 'geo_states':
                                $jq('#state').html('<option value="0">'+joinLangParts.choose_a_state+'</option>' + data.list).trigger('refresh');
                                $jq('#city').html(option).trigger('refresh');
                                break
                            case 'geo_cities':
                                $jq('#city').html(option + data.list).trigger('refresh');
                                break
                        }
                    }
                    $jq('#css_loader_location').addClass('hidden');
                    $jq('.location').prop('disabled', false).trigger('refresh');
                }
            });
            return false;
        })


        // submit form

        $('#frm_users_add').submit(function(event) {
            event.preventDefault();
            let candidate_cvInput = $("#candidate_cv")[0];

            let email = $("#email").val()
            let username = $("#username").val()
            let full_phone_number = $("#full_phone_number").val()

            let country = $("#country").val()
            let state = $("#state").val()
            let city = $("#city").val()
            
            // dpz-upload-single-icon
            let photo_file = $('#dpz-upload-single-icon')[0].dropzone.getAcceptedFiles()[0];

            // define formdata
            var formData = new FormData(this);

            var msg = ``;
            let listIcon = "<i class='fa fa-circle' style='color: #555;font-size: 12px'></i> ";

            /*if(photo_file == undefined)
                msg += "{l_please_enter_candidate_photo}<br>";
            else {
                if(photo_file.size > upload_max_filesize)
                    msg += `Profile photo cannot be larger than ${Math.round(upload_max_filesize/1024/1024)}MB.<br>`;
            }*/

            if(photo_file !== undefined && photo_file.size > upload_max_filesize)
                msg += listIcon+`Profile photo cannot be larger than ${Math.round(upload_max_filesize/1024/1024)}MB.<br>`;

            if ($('#have_cv_yes').val() == 1) {
                var submitButton = $("#UploadSubmit");

                if (candidate_cvInput.files.length > 0) {
                    let candidate_cv = candidate_cvInput.files[0];
                    
                    let allowedExtensions = ['.docx', '.pdf'];
                    let fileExtension = candidate_cv.name.split('.').pop().toLowerCase();

                    if (allowedExtensions.includes('.' + fileExtension)) {
                        // File has a valid extension
                        // console.log("Valid file selected:", candidate_cv);
                        formData.append('candidate_cv', candidate_cv);
                    } else {
                        // Invalid file extension
                        msg += listIcon+"{l_biodata_invalid_etension}<br>";
                    }
                } else
                    msg += listIcon+"{l_please_enter_candidate_biodata}<br>";
            } else { // manual
                var submitButton = $("#submit");

                let gender = $("#bl_join_done_orientation").val();
                let day = $("#day").val();
                let month = $("#month").val();
                let year = $("#year").val();

                // if(username == "" || !nameValid(username) || full_phone_number == "" || country == 0 || state == 0 || city == 0 || photo_file == undefined || gender == null || day == null || month == null || year == null) {

                    if(username == "")
                        msg += listIcon+"{l_please_enter_candidate_name}<br>";
                    if(username && !nameValid(username))
                        msg += listIcon+'{l_invalid_candidate_name}<br>';
                    if(gender == null)
                        msg += listIcon+"{l_please_choose_the_gender}<br>";

                    if(full_phone_number == "")
                        msg += listIcon+"{l_please_enter_phone_number}<br>";
                    else if(!validatePhoneNumber(full_phone_number))
                        msg += listIcon+"{l_phone_number_is_not_valid}<br>";

                    if(day == null || month == null || year == null)
                        msg += listIcon+"{l_incorrect_date}<br>";
                    else {
                        // Parse the input date
                        var birthDate = new Date(year, month - 1, day); // month is 0-indexed
                        var today = new Date();

                        // Calculate age
                        var age = today.getFullYear() - birthDate.getFullYear();
                        var monthDifference = today.getMonth() - birthDate.getMonth();

                        // Adjust age if today's date is before the birthday in the current year
                        if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                            age--;
                        }

                        // Check if age is less than 18
                        if (age < 18) {
                            msg += listIcon+"{l_incorrect_date}<br>";
                        }
                    }

                    if(country == 0)
                        msg += listIcon+"{l_please_choose_the_country}<br>";
                    if(state == 0)
                        msg += listIcon+"{l_please_choose_the_division}<br>";
                    if(city == 0)
                        msg += listIcon+"{l_please_choose_the_district}";
                    
                }
            // }

            if(msg !=='')
                alertCustom(msg,true,'');
            else {
                $("#manualClickbutton").attr("disabled", "disabled");
                submitButton.attr("disabled", "disabled")
                submitButton.html(btnLoader);

                if(photo_file !== undefined)
                    formData.append('photo_file', photo_file);

                if ($('#have_cv_yes').val() == 1) {

                    $.ajax({
                        url: 'add_user',
                        type: "post",
                        data:formData,
                        cache:false,
                        contentType: false,
                        processData: false,
                        success:function(data){
                            try {
                                var responseMsg = JSON.parse(data);
                                // console.log(responseMsg.error, responseMsg.success, responseMsg.message);

                                if(responseMsg.success == 1) {
                                    alertSpecial('edit_user?name='+responseMsg.message, "{l_user_created_successfully}", "Success");
                                    // redirectUrl('edit_user?name='+responseMsg.message);
                                } else {
                                    alertCustom(responseMsg.message,true,'Failed!');
                                    $("#candidate_cv").val('');
                                }

                            } catch(e) {
                                alertCustom('{l_something_wrong}',true,'Failed!');
                                $("#candidate_cv").val('');
                                $(".confirm_ok").click(function() {
                                    location.reload()
                                });
                            }
                            

                            submitButton.attr("disabled", false)
                            submitButton.html(`{l_create_user}`);
                            $("#manualClickbutton").attr("disabled", false);                                                        
                        }
                    })

                } else {

                    $.ajax({
                        url: 'add_user',
                        type: "post",
                        data:formData,
                        cache:false,
                        contentType: false,
                        processData: false,
                        success:function(data){

                            try {

                                var responseMsg = JSON.parse(data);
                                // console.log(responseMsg.error, responseMsg.success, responseMsg.message);

                                if(responseMsg.success == 1) {
                                    alertSpecial('edit_user?name='+responseMsg.message, "{l_user_created_successfully}", "Success");
                                    // redirectUrl('edit_user?name='+responseMsg.message);
                                } else {
                                    alertCustom(responseMsg.message,true,'Failed!');
                                }

                            } catch(e) {
                                alertCustom('{l_something_wrong}',true,'Failed!');
                                $(".confirm_ok").click(function() {
                                    location.reload()
                                });
                            }


                            submitButton.attr("disabled", false)
                            submitButton.html(`{l_create_user}`);
                            $("#manualClickbutton").attr("disabled", false);
                            
                        }
                    })

                }
            }
        });

    })

</script>

<script src="{url_main}_frameworks/administration/modern/app-assets/vendors/js/extensions/dropzone.min.js{cache_version_param}" type="text/javascript"></script>
<script src="{url_main}_frameworks/administration/modern/js/dropzone.js{cache_version_param}" type="text/javascript"></script>
{footer}